import{c as L,S as me,h as he,r as ee,K as ge,p as q,o as ye,T as te,I as Z,J as ve}from"./use-translate.5fa8a2a1.js";import{d as J,a as De,n as ne,m as se,t as I,c as we,w as be}from"./with-install.ff23f643.js";import{u as ke}from"./use-refs.abd3b4ec.js";import{u as fe}from"./use-expose.840221e5.js";import{P as Se}from"./index.5bc144fc.js";import{B as Te}from"./index.6b2fff9d.js";import{s as ce}from"./index.97866e22.js";import{g as xe}from"./utils.44a2392e.js";import{u as Me}from"./use-height.ad04b230.js";import{A as _,D as M,e as c,u as z,x as p,B as Re}from"./vue-libs.ed3d9812.js";const[Ce,f,W]=L("calendar"),Oe=e=>W("monthTitle",e.getFullYear(),e.getMonth()+1);function ae(e,s){const i=e.getFullYear(),d=s.getFullYear();if(i===d){const b=e.getMonth(),x=s.getMonth();return b===x?0:b>x?1:-1}return i>d?1:-1}function R(e,s){const i=ae(e,s);if(i===0){const d=e.getDate(),b=s.getDate();return d===b?0:d>b?1:-1}return i}const K=e=>new Date(e),ue=e=>Array.isArray(e)?e.map(K):K(e);function le(e,s){const i=K(e);return i.setDate(i.getDate()+s),i}const oe=e=>le(e,-1),de=e=>le(e,1),re=()=>{const e=new Date;return e.setHours(0,0,0,0),e};function Pe(e){const s=e[0].getTime();return(e[1].getTime()-s)/(1e3*60*60*24)+1}const[Be]=L("calendar-day"),Ae=_({name:Be,props:{item:J(Object),color:String,index:Number,offset:De(0),rowHeight:String},emits:["click"],setup(e,{emit:s,slots:i}){const d=M(()=>{var N;const{item:a,index:g,color:k,offset:H,rowHeight:O}=e,S={height:O};if(a.type==="placeholder")return S.width="100%",S;if(g===0&&(S.marginLeft=`${100*H/7}%`),k)switch(a.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":S.background=k;break;case"middle":S.color=k;break}return H+(((N=a.date)==null?void 0:N.getDate())||1)>28&&(S.marginBottom=0),S}),b=()=>{e.item.type!=="disabled"&&s("click",e.item)},x=()=>{const{topInfo:a}=e.item;if(a||i["top-info"])return c("div",{class:f("top-info")},[i["top-info"]?i["top-info"](e.item):a])},C=()=>{const{bottomInfo:a}=e.item;if(a||i["bottom-info"])return c("div",{class:f("bottom-info")},[i["bottom-info"]?i["bottom-info"](e.item):a])},w=()=>{const{item:a,color:g,rowHeight:k}=e,{type:H,text:O}=a,S=[x(),O,C()];return H==="selected"?c("div",{class:f("selected-day"),style:{width:k,height:k,background:g}},[S]):S};return()=>{const{type:a,className:g}=e.item;return a==="placeholder"?c("div",{class:f("day"),style:d.value},null):c("div",{role:"gridcell",style:d.value,class:[f("day",a),g],tabindex:a==="disabled"?void 0:-1,onClick:b},[w()])}}}),[Ie]=L("calendar-month"),He={date:J(Date),type:String,color:String,minDate:J(Date),maxDate:J(Date),showMark:Boolean,rowHeight:ne,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number},We=_({name:Ie,props:He,emits:["click"],setup(e,{emit:s,slots:i}){const[d,b]=me(),x=z(),C=z(),w=Me(C),a=M(()=>Oe(e.date)),g=M(()=>he(e.rowHeight)),k=M(()=>{const o=e.date.getDay();return e.firstDayOfWeek?(o+7-e.firstDayOfWeek)%7:o}),H=M(()=>xe(e.date.getFullYear(),e.date.getMonth()+1)),O=M(()=>d.value||!e.lazyRender),S=()=>a.value,N=o=>{const m=y=>e.currentDate.some(u=>R(u,y)===0);if(m(o)){const y=oe(o),u=de(o),v=m(y),t=m(u);return v&&t?"multiple-middle":v?"end":t?"start":"multiple-selected"}return""},F=o=>{const[m,y]=e.currentDate;if(!m)return"";const u=R(o,m);if(!y)return u===0?"start":"";const v=R(o,y);return e.allowSameDay&&u===0&&v===0?"start-end":u===0?"start":v===0?"end":u>0&&v<0?"middle":""},E=o=>{const{type:m,minDate:y,maxDate:u,currentDate:v}=e;if(R(o,y)<0||R(o,u)>0)return"disabled";if(v===null)return"";if(Array.isArray(v)){if(m==="multiple")return N(o);if(m==="range")return F(o)}else if(m==="single")return R(o,v)===0?"selected":"";return""},Y=o=>{if(e.type==="range"){if(o==="start"||o==="end")return W(o);if(o==="start-end")return`${W("start")}/${W("end")}`}},V=()=>{if(e.showMonthTitle)return c("div",{class:f("month-title")},[a.value])},j=()=>{if(e.showMark&&O.value)return c("div",{class:f("month-mark")},[e.date.getMonth()+1])},U=M(()=>{const o=Math.ceil((H.value+k.value)/7);return Array(o).fill({type:"placeholder"})}),$=M(()=>{const o=[],m=e.date.getFullYear(),y=e.date.getMonth();for(let u=1;u<=H.value;u++){const v=new Date(m,y,u),t=E(v);let n={date:v,type:t,text:u,bottomInfo:Y(t)};e.formatter&&(n=e.formatter(n)),o.push(n)}return o}),P=M(()=>$.value.filter(o=>o.type==="disabled")),G=(o,m)=>{if(x.value){const y=ee(x.value),u=U.value.length,t=(Math.ceil((m.getDate()+k.value)/7)-1)*y.height/u;ge(o,y.top+t+o.scrollTop-ee(o).top)}},Q=(o,m)=>c(Ae,{item:o,index:m,color:e.color,offset:k.value,rowHeight:g.value,onClick:y=>s("click",y)},q(i,["top-info","bottom-info"])),X=()=>c("div",{ref:x,role:"grid",class:f("days")},[j(),(O.value?$:U).value.map(Q)]);return fe({getTitle:S,getHeight:()=>w.value,setVisible:b,scrollToDate:G,disabledDays:P}),()=>c("div",{class:f("month"),ref:C},[V(),X()])}}),[Ne]=L("calendar-header"),Fe=_({name:Ne,props:{date:Date,title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["clickSubtitle"],setup(e,{slots:s,emit:i}){const d=()=>{if(e.showTitle){const w=e.title||W("title"),a=s.title?s.title():w;return c("div",{class:f("header-title")},[a])}},b=w=>i("clickSubtitle",w),x=()=>{if(e.showSubtitle){const w=s.subtitle?s.subtitle({date:e.date,text:e.subtitle}):e.subtitle;return c("div",{class:f("header-subtitle"),onClick:b},[w])}},C=()=>{const{firstDayOfWeek:w}=e,a=W("weekdays"),g=[...a.slice(w,7),...a.slice(0,w)];return c("div",{class:f("weekdays")},[g.map(k=>c("span",{class:f("weekday")},[k]))])};return()=>c("div",{class:f("header")},[d(),x(),C()])}}),Ye={show:Boolean,type:se("single"),title:String,color:String,round:I,readonly:Boolean,poppable:I,maxRange:we(null),position:se("bottom"),teleport:[String,Object],showMark:I,showTitle:I,formatter:Function,rowHeight:ne,confirmText:String,rangePrompt:String,lazyRender:I,showConfirm:I,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:I,closeOnPopstate:I,showRangePrompt:I,confirmDisabledText:String,closeOnClickOverlay:I,safeAreaInsetTop:Boolean,safeAreaInsetBottom:I,minDate:{type:Date,validator:te,default:re},maxDate:{type:Date,validator:te,default:()=>{const e=re();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:ne,default:0,validator:e=>e>=0&&e<=6}},$e=_({name:Ce,props:Ye,emits:["select","confirm","unselect","monthShow","overRange","update:show","clickSubtitle"],setup(e,{emit:s,slots:i}){const d=(t,n=e.minDate,r=e.maxDate)=>R(t,n)===-1?n:R(t,r)===1?r:t,b=(t=e.defaultDate)=>{const{type:n,minDate:r,maxDate:l,allowSameDay:T}=e;if(t===null)return t;const D=re();if(n==="range"){Array.isArray(t)||(t=[]);const B=d(t[0]||D,r,T?l:oe(l)),h=d(t[1]||D,T?r:de(r));return[B,h]}return n==="multiple"?Array.isArray(t)?t.map(B=>d(B)):[d(D)]:((!t||Array.isArray(t))&&(t=D),d(t))};let x;const C=z(),w=z({text:"",date:void 0}),a=z(b()),[g,k]=ke(),H=M(()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0),O=M(()=>{const t=[],n=new Date(e.minDate);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(ae(n,e.maxDate)!==1);return t}),S=M(()=>{if(a.value){if(e.type==="range")return!a.value[0]||!a.value[1];if(e.type==="multiple")return!a.value.length}return!a.value}),N=()=>a.value,F=()=>{const t=ve(C.value),n=t+x,r=O.value.map((h,A)=>g.value[A].getHeight()),l=r.reduce((h,A)=>h+A,0);if(n>l&&t>0)return;let T=0,D;const B=[-1,-1];for(let h=0;h<O.value.length;h++){const A=g.value[h];T<=n&&T+r[h]>=t&&(B[1]=h,D||(D=A,B[0]=h),g.value[h].showed||(g.value[h].showed=!0,s("monthShow",{date:A.date,title:A.getTitle()}))),T+=r[h]}O.value.forEach((h,A)=>{const ie=A>=B[0]-1&&A<=B[1]+1;g.value[A].setVisible(ie)}),D&&(w.value={text:D.getTitle(),date:D.date})},E=t=>{Z(()=>{O.value.some((n,r)=>ae(n,t)===0?(C.value&&g.value[r].scrollToDate(C.value,t),!0):!1),F()})},Y=()=>{if(!(e.poppable&&!e.show))if(a.value){const t=e.type==="single"?a.value:a.value[0];te(t)&&E(t)}else Z(F)},V=()=>{e.poppable&&!e.show||(Z(()=>{x=Math.floor(ee(C).height)}),Y())},j=(t=b())=>{a.value=t,Y()},U=t=>{const{maxRange:n,rangePrompt:r,showRangePrompt:l}=e;return n&&Pe(t)>n?(l&&ce(r||W("rangePrompt",n)),s("overRange"),!1):!0},$=()=>{var t;return s("confirm",(t=a.value)!=null?t:ue(a.value))},P=(t,n)=>{const r=l=>{a.value=l,s("select",ue(l))};if(n&&e.type==="range"&&!U(t)){r([t[0],le(t[0],+e.maxRange-1)]);return}r(t),n&&!e.showConfirm&&$()},G=(t,n,r)=>{var l;return(l=t.find(T=>R(n,T.date)===-1&&R(T.date,r)===-1))==null?void 0:l.date},Q=M(()=>g.value.reduce((t,n)=>{var r,l;return t.push(...(l=(r=n.disabledDays)==null?void 0:r.value)!=null?l:[]),t},[])),X=t=>{if(e.readonly||!t.date)return;const{date:n}=t,{type:r}=e;if(r==="range"){if(!a.value){P([n]);return}const[l,T]=a.value;if(l&&!T){const D=R(n,l);if(D===1){const B=G(Q.value,l,n);if(B){const h=oe(B);R(l,h)===-1?P([l,h]):P([n])}else P([l,n],!0)}else D===-1?P([n]):e.allowSameDay&&P([n,n],!0)}else P([n])}else if(r==="multiple"){if(!a.value){P([n]);return}const l=a.value,T=l.findIndex(D=>R(D,n)===0);if(T!==-1){const[D]=l.splice(T,1);s("unselect",K(D))}else e.maxRange&&l.length>=e.maxRange?ce(e.rangePrompt||W("rangePrompt",e.maxRange)):P([...l,n])}else P(n,!0)},o=t=>s("update:show",t),m=(t,n)=>{const r=n!==0||!e.showSubtitle;return c(We,Re({ref:k(n),date:t,currentDate:a.value,showMonthTitle:r,firstDayOfWeek:H.value},q(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:X}),q(i,["top-info","bottom-info"]))},y=()=>{if(i.footer)return i.footer();if(e.showConfirm){const t=i["confirm-text"],n=S.value,r=n?e.confirmDisabledText:e.confirmText;return c(Te,{round:!0,block:!0,type:"primary",color:e.color,class:f("confirm"),disabled:n,nativeType:"button",onClick:$},{default:()=>[t?t({disabled:n}):r||W("confirm")]})}},u=()=>c("div",{class:[f("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[y()]),v=()=>c("div",{class:f()},[c(Fe,{date:w.value.date,title:e.title,subtitle:w.value.text,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:H.value,onClickSubtitle:t=>s("clickSubtitle",t)},q(i,["title","subtitle"])),c("div",{ref:C,class:f("body"),onScroll:F},[O.value.map(m)]),u()]);return p(()=>e.show,V),p(()=>[e.type,e.minDate,e.maxDate],()=>j(b(a.value))),p(()=>e.defaultDate,(t=null)=>{a.value=t,Y()}),fe({reset:j,scrollToDate:E,getSelectedDate:N}),ye(V),()=>e.poppable?c(Se,{show:e.show,class:f("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,"onUpdate:show":o},{default:v}):v()}}),Ge=be($e);export{Ge as C};
