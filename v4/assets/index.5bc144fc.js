import{o as K,m as N,l as j,e as F,c as H,i as M,n as G}from"./use-translate.5fa8a2a1.js";import{n as A,t as O,u as U,m as x,w as Y}from"./with-install.ff23f643.js";import{L,I as V,x as g,A as $,u as T,D as q,q as J,M as W,J as Z,e as v,S as Q,F as X,T as ee,P as oe,j as ne,v as te,B as ae}from"./vue-libs.ed3d9812.js";import{H as se}from"./constant.80c6de18.js";import{c as ce}from"./interceptor.f92ff708.js";import{u as re}from"./use-expose.840221e5.js";import{u as le}from"./use-touch.ecfb8eef.js";import{u as ie}from"./use-lazy-render.997d3548.js";import{P as ue}from"./on-popup-reopen.08d2a38f.js";import{u as de,I as fe}from"./index.dc9079c8.js";import{O as ve}from"./index.5e96c57f.js";const D={show:Boolean,zIndex:A,overlay:O,duration:A,teleport:[String,Object],lockScroll:O,lazyRender:O,beforeClose:Function,overlayStyle:Object,overlayClass:U,transitionAppear:Boolean,closeOnClickOverlay:O},Be=Object.keys(D);let y=0;const B="van-overflow-hidden";function me(e,n){const s=le(),i="01",t="10",r=c=>{s.move(c);const d=s.deltaY.value>0?t:i,C=N(c.target,e.value),{scrollHeight:m,offsetHeight:h,scrollTop:p}=C;let f="11";p===0?f=h>=m?"00":"01":p+h>=m&&(f="10"),f!=="11"&&s.isVertical()&&!(parseInt(f,2)&parseInt(d,2))&&j(c,!0)},u=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",r,{passive:!1}),y||document.body.classList.add(B),y++},l=()=>{y&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",r),y--,y||document.body.classList.remove(B))},P=()=>n()&&u(),I=()=>n()&&l();K(P),L(I),V(I),g(n,c=>{c?u():l()})}const ye=F({},D,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Ie,E]=H("popup"),he=$({name:Ie,inheritAttrs:!1,props:ye,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:n,attrs:s,slots:i}){let t,r;const u=T(),l=T(),P=ie(()=>e.show||!e.lazyRender),I=q(()=>{const o={zIndex:u.value};if(M(e.duration)){const a=e.position==="center"?"animationDuration":"transitionDuration";o[a]=`${e.duration}s`}return o}),c=()=>{t||(t=!0,u.value=e.zIndex!==void 0?+e.zIndex:de(),n("open"))},d=()=>{t&&ce(e.beforeClose,{done(){t=!1,n("close"),n("update:show",!1)}})},C=o=>{n("clickOverlay",o),e.closeOnClickOverlay&&d()},m=()=>{if(e.overlay)return v(ve,{show:e.show,class:e.overlayClass,zIndex:u.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:C},{default:i["overlay-content"]})},h=o=>{n("clickCloseIcon",o),d()},p=()=>{if(e.closeable)return v(fe,{role:"button",tabindex:0,name:e.closeIcon,class:[E("close-icon",e.closeIconPosition),se],classPrefix:e.iconPrefix,onClick:h},null)},f=()=>n("opened"),z=()=>n("closed"),R=o=>n("keydown",o),_=P(()=>{var S;const{round:o,position:a,safeAreaInsetTop:k,safeAreaInsetBottom:w}=e;return ne(v("div",ae({ref:l,style:I.value,role:"dialog",tabindex:0,class:[E({round:o,[a]:a}),{"van-safe-area-top":k,"van-safe-area-bottom":w}],onKeydown:R},s),[(S=i.default)==null?void 0:S.call(i),p()]),[[te,e.show]])}),b=()=>{const{position:o,transition:a,transitionAppear:k}=e,w=o==="center"?"van-fade":`van-popup-slide-${o}`;return v(ee,{name:a||w,appear:k,onAfterEnter:f,onAfterLeave:z},{default:_})};return g(()=>e.show,o=>{o&&!t&&(c(),s.tabindex===0&&J(()=>{var a;(a=l.value)==null||a.focus()})),!o&&t&&(t=!1,n("close"))}),re({popupRef:l}),me(l,()=>e.show&&e.lockScroll),G("popstate",()=>{e.closeOnPopstate&&(d(),r=!1)}),W(()=>{e.show&&c()}),Z(()=>{r&&(n("update:show",!0),r=!1)}),L(()=>{e.show&&e.teleport&&(d(),r=!0)}),oe(ue,()=>e.show),()=>e.teleport?v(Q,{to:e.teleport},{default:()=>[m(),b()]}):v(X,null,[m(),b()])}}),Ee=Y(he);export{Ee as P,Be as a,D as p};
