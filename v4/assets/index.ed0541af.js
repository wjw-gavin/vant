import{c as O,n as ee,l as k,F as C,M as oe,Q as te,p as ae,r as se,d as ne,e as ie}from"./use-translate.5fa8a2a1.js";import{m as ce,u as re}from"./mount-component.6bbd68ed.js";import{A as _,H as F,u as L,D as T,x as b,e as l,M as le,q as me,B as j,Q as ue}from"./vue-libs.ed3d9812.js";import{d as H,n as A,t as Z,b as de,c as z,u as $,m as B,w as ve}from"./with-install.ff23f643.js";import{H as ge}from"./constant.80c6de18.js";import{c as fe}from"./interceptor.f92ff708.js";import{u as he}from"./use-expose.840221e5.js";import{I as we}from"./index.dc9079c8.js";import{a as Pe,S as Ie}from"./index.79003321.js";import{P as pe}from"./index.5bc144fc.js";import{u as xe}from"./use-touch.ecfb8eef.js";import{I as ye}from"./index.89613652.js";import{L as Se}from"./index.200bbe9c.js";const E=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),W=O("image-preview")[1],Ce=_({props:{src:String,show:Boolean,active:Number,minZoom:H(A),maxZoom:H(A),rootWidth:H(Number),rootHeight:H(Number)},emits:["scale","close"],setup(e,{emit:c,slots:m}){const o=F({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=xe(),h=L(),x=T(()=>{const{rootWidth:t,rootHeight:s}=e,i=s/t;return o.imageRatio>i}),X=T(()=>{const{scale:t,moveX:s,moveY:i,moving:v,zooming:I}=o,Y={transitionDuration:I||v?"0s":".3s"};if(t!==1){const G=s/t,J=i/t;Y.transform=`scale(${t}, ${t}) translate(${G}px, ${J}px)`}return Y}),g=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=x.value?s/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),u=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=x.value?s:t*o.imageRatio;return Math.max(0,(o.scale*i-s)/2)}return 0}),y=t=>{t=C(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},S=()=>{y(1),o.moveX=0,o.moveY=0},R=()=>{const t=o.scale>1?1:2;y(t),o.moveX=0,o.moveY=0};let w,P,f,a,d,r,D;const Q=t=>{const{touches:s}=t,{offsetX:i}=n;n.start(t),w=s.length,P=o.moveX,f=o.moveY,D=Date.now(),o.moving=w===1&&o.scale!==1,o.zooming=w===2&&!i.value,o.zooming&&(a=o.scale,d=E(t.touches))},U=t=>{const{touches:s}=t;if(n.move(t),(o.moving||o.zooming)&&k(t,!0),o.moving){const{deltaX:i,deltaY:v}=n,I=i.value+P,Y=v.value+f;o.moveX=C(I,-g.value,g.value),o.moveY=C(Y,-u.value,u.value)}if(o.zooming&&s.length===2){const i=E(s),v=a*i/d;y(v)}},V=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=n,i=Date.now()-D,v=250,I=5;t.value<I&&s.value<I&&i<v&&(r?(clearTimeout(r),r=null,R()):r=setTimeout(()=>{c("close"),r=null},v))},N=t=>{let s=!1;(o.moving||o.zooming)&&(s=!0,o.moving&&P===o.moveX&&f===o.moveY&&(s=!1),t.touches.length||(o.zooming&&(o.moveX=C(o.moveX,-g.value,g.value),o.moveY=C(o.moveY,-u.value,u.value),o.zooming=!1),o.moving=!1,P=0,f=0,a=1,o.scale<1&&S(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),k(t,s),V(),n.reset()},K=t=>{const{naturalWidth:s,naturalHeight:i}=t.target;o.imageRatio=i/s};return b(()=>e.active,S),b(()=>e.show,t=>{t||S()}),ee("touchmove",U,{target:T(()=>{var t;return(t=h.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>l(Se,{type:"spinner"},null)};return l(Pe,{ref:h,class:W("swipe-item"),onTouchstartPassive:Q,onTouchend:N,onTouchcancel:N},{default:()=>[m.image?l("div",{class:W("image-wrap")},[m.image({src:e.src})]):l(ye,{src:e.src,fit:"contain",class:W("image",{vertical:x.value}),style:X.value,onLoad:K},t)]})}}});function Te(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ue(e)}const[be,p]=O("image-preview"),Xe=["show","transition","overlayStyle","closeOnPopstate"],Ye={show:Boolean,loop:Z,images:de(),minZoom:z(1/3),maxZoom:z(3),overlay:Z,closeable:Boolean,showIndex:Z,className:$,closeIcon:B("clear"),transition:String,beforeClose:Function,overlayClass:$,overlayStyle:Object,swipeDuration:z(300),startPosition:z(0),showIndicators:Boolean,closeOnPopstate:Z,closeIconPosition:B("top-right")},q=_({name:be,props:Ye,emits:["scale","close","closed","change","update:show"],setup(e,{emit:c,slots:m}){const o=L(),n=F({active:0,rootWidth:0,rootHeight:0}),h=()=>{if(o.value){const a=se(o.value.$el);n.rootWidth=a.width,n.rootHeight=a.height,o.value.resize()}},x=a=>c("scale",a),X=a=>c("update:show",a),g=()=>{fe(e.beforeClose,{args:[n.active],done:()=>X(!1)})},u=a=>{a!==n.active&&(n.active=a,c("change",a))},y=()=>{if(e.showIndex)return l("div",{class:p("index")},[m.index?m.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},S=()=>{if(m.cover)return l("div",{class:p("cover")},[m.cover()])},R=()=>{let a;return l(Ie,{ref:o,lazyRender:!0,loop:e.loop,class:p("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u},Te(a=e.images.map(d=>l(Ce,{src:d,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,onScale:x,onClose:g},{image:m.image})))?a:{default:()=>[a]})},w=()=>{if(e.closeable)return l(we,{role:"button",name:e.closeIcon,class:[p("close-icon",e.closeIconPosition),ge],onClick:g},null)},P=()=>c("closed"),f=(a,d)=>{var r;return(r=o.value)==null?void 0:r.swipeTo(a,d)};return he({swipeTo:f}),le(h),b([oe,te],h),b(()=>e.startPosition,a=>u(+a)),b(()=>e.show,a=>{const{images:d,startPosition:r}=e;a?(u(+r),me(()=>{h(),f(+r,{immediate:!0})})):c("close",{index:n.active,url:d[n.active]})}),()=>l(pe,j({class:[p(),e.className],overlayClass:[p("overlay"),e.overlayClass],onClosed:P,"onUpdate:show":X},ae(e,Xe)),{default:()=>[w(),R(),y(),S()]})}});let M;const He={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Ze(){({instance:M}=ce({setup(){const{state:e,toggle:c}=re(),m=()=>{e.images=[]};return()=>l(q,j(e,{onClosed:m,"onUpdate:show":c}),null)}}))}const Fe=(e,c=0)=>{if(!!ne)return M||Ze(),e=Array.isArray(e)?{images:e,startPosition:c}:e,M.open(ie({},He,e)),M},Le=ve(q);export{Le as I,Fe as s};
