import{d as w,c as E,q as D,l as S,a as L}from"./use-translate-71d4880c.js";import{B as _}from"./index-2ad848b9.js";import{A as N,y as b,H as V,M as j,q as z,e as o,r as M,o as y,a as q,w as p,C as s,c as F,f as H,F as I}from"./vue-libs-19c20d28.js";import{m as C,a as X,w as Y}from"./with-install-560d59bf.js";import{V as A}from"./index-1122429d.js";import{s as J}from"./function-call-6b639af0.js";import"./use-route-751feeeb.js";import"./index-1ef61aa2.js";import"./index-8bc2514f.js";import"./index-2b75ebd8.js";import"./constant-ee6e27d7.js";import"./mount-component-b555bf78.js";import"./use-expose-80cfd2b2.js";import"./index-140c52d7.js";import"./use-lock-scroll-01f1fb06.js";import"./use-touch-4e22f945.js";import"./use-lazy-render-e63df66f.js";import"./on-popup-reopen-6f4c2d78.js";import"./index-cd342d67.js";import"./interceptor-07dc6e0f.js";const[$,x,B]=E("signature"),G={tips:String,type:C("png"),penColor:C("#000"),lineWidth:X(3),clearButtonText:String,backgroundColor:C(""),confirmButtonText:String},K=()=>{var a;const n=document.createElement("canvas");return!!((a=n.getContext)!=null&&a.call(n,"2d"))},O=N({name:$,props:G,emits:["submit","clear","start","end","signing"],setup(n,{emit:a}){const c=b(),l=b(),t=V({width:0,height:0,ctx:null,ratio:w?window.devicePixelRatio:1});let i;const f=w?K():!0,u=()=>{if(!t.ctx)return!1;t.ctx.beginPath(),t.ctx.lineWidth=n.lineWidth*t.ratio,t.ctx.strokeStyle=n.penColor,i=D(c),a("start")},T=e=>{var d,v;if(!t.ctx)return!1;S(e);const r=e.touches[0],m=(r.clientX-((i==null?void 0:i.left)||0))*t.ratio,h=(r.clientY-((i==null?void 0:i.top)||0))*t.ratio;t.ctx.lineCap="round",t.ctx.lineJoin="round",(d=t.ctx)==null||d.lineTo(m,h),(v=t.ctx)==null||v.stroke(),a("signing",e)},R=e=>{S(e),a("end")},P=e=>{const r=document.createElement("canvas");return r.width=e.width,r.height=e.height,e.toDataURL()===r.toDataURL()},k=()=>{t.ctx&&n.backgroundColor&&(t.ctx.fillStyle=n.backgroundColor,t.ctx.fillRect(0,0,t.width,t.height))},U=()=>{var h,d;const e=c.value;if(!e)return;const m=P(e)?"":((d=(h={jpg:()=>e.toDataURL("image/jpeg",.8),jpeg:()=>e.toDataURL("image/jpeg",.8)})[n.type])==null?void 0:d.call(h))||e.toDataURL(`image/${n.type}`);a("submit",{image:m,canvas:e})},W=()=>{t.ctx&&(t.ctx.clearRect(0,0,t.width,t.height),t.ctx.closePath(),k()),a("clear")};return j(()=>{var e,r,m;f&&(t.ctx=(e=c.value)==null?void 0:e.getContext("2d"),t.width=(((r=l.value)==null?void 0:r.offsetWidth)||0)*t.ratio,t.height=(((m=l.value)==null?void 0:m.offsetHeight)||0)*t.ratio,z(()=>{k()}))}),()=>o("div",{class:x()},[o("div",{class:x("content"),ref:l},[f?o("canvas",{ref:c,width:t.width,height:t.height,onTouchstartPassive:u,onTouchmove:T,onTouchend:R},null):o("p",null,[n.tips])]),o("div",{class:x("footer")},[o(_,{size:"small",onClick:W},{default:()=>[n.clearButtonText||B("clear")]}),o(_,{type:"primary",size:"small",onClick:U},{default:()=>[n.confirmButtonText||B("confirm")]})])])}}),Q=Y(O),g=Q,bt={__name:"index",setup(n){const a=L({"zh-CN":{penColor:"自定义颜色",lineWidth:"自定义线宽",backgroundColor:"自定义背景颜色"},"en-US":{penColor:"Pen Color",lineWidth:"Line Width",backgroundColor:"Background Color"}}),c=b(""),l=i=>{c.value=i.image},t=()=>J("clear");return(i,f)=>{const u=M("demo-block");return y(),q(I,null,[o(u,{title:s(a)("basicUsage")},{default:p(()=>[o(s(g),{onSubmit:l,onClear:t})]),_:1},8,["title"]),c.value?(y(),F(s(A),{key:0,src:c.value},null,8,["src"])):H("",!0),o(u,{title:s(a)("penColor")},{default:p(()=>[o(s(g),{"pen-color":"#ff0000",onClear:t,onSubmit:l})]),_:1},8,["title"]),o(u,{title:s(a)("lineWidth")},{default:p(()=>[o(s(g),{"line-width":6,onClear:t,onSubmit:l})]),_:1},8,["title"]),o(u,{title:s(a)("backgroundColor")},{default:p(()=>[o(s(g),{"background-color":"#eee",onClear:t,onSubmit:l})]),_:1},8,["title"])],64)}}};export{bt as default};
